# Sofia Memory Plugin

Sofia Memory Plugin \u2014 это небольшой сервис на Node.js, предоставляющий REST API для работы с файлами памяти и планами обучения. В репозитории хранится пример структуры памяти, набор утилит для обработки Markdown и тесты.

## Быстрый старт

1. Установите зависимости:
   ```bash
   npm install
   ```
2. Запустите сервер:
   ```bash
   npm start
   ```
   По умолчанию приложение слушает порт `10000`.

Для конфигурации можно использовать файл `.env` (см. `.env.example`) или `config/config.json`, где задаются URL репозиториев и токены доступа.

## Запуск тестов

Все unit-тесты запускаются командой:
```bash
npm test
```

## Основные эндпойнты

Полное описание находится в файле `openapi.yaml` и доступно через `GET /docs` после запуска сервера. Ниже перечислены ключевые маршруты:

- `POST /save` \u2014 сохранить файл в репозитории;
- `POST /read` \u2014 прочитать содержимое файла;
- `POST /saveMemory` и `POST /readMemory` \u2014 работа с основной памятью;
- `POST /saveMemoryWithIndex` \u2014 сохранить файл и обновить `index.json`;
- `POST /saveLessonPlan` \u2014 обновить план обучения;
- `POST /setMemoryRepo` \u2014 задать репозиторий пользователя;
- `POST /version/commit` и `POST /version/rollback` \u2014 управление версиями инструкций;
- `GET /profile` \u2014 получить сохраненный профиль;
- `GET /ping` \u2014 проверка работоспособности.

## Кодстайл

В проекте допустимы три стиля именования:

- `snake_case`;
- `UPPER_SNAKE_CASE`;
- `И_Мой_Стиль`.

Использование camelCase и других вариантов не приветствуется. Перед коммитом убедитесь, что новые файлы и функции соответствуют одному из указанных стилей.

## Работа с `index.json`

Утилиты из `tools/index_manager.js` помогают поддерживать актуальный список уроков и других файлов. Основные функции:

- `validateFilePathAgainstIndex(path)` \u2014 сверяет путь с данными из индекса и подсказывает корректное расположение файла;
- `getLessonPath(num)` \u2014 возвращает путь урока по номеру, создавая запись вида `memory/lessons/lesson_XX.md`, если ее еще нет.

Эти функции упрощают добавление новых материалов и предотвращают появление дубликатов.

