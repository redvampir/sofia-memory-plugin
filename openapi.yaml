openapi: 3.1.0
info:
  title: Sofia Memory API
  version: 1.0.0
  description: >-
    Минимальное описание публичных методов памяти Софии для интеграции
    внешних сервисов.
servers:
  - url: http://localhost:10000
    description: Базовый URL сервиса; подставляется из переменной окружения PUBLIC_BASE_URL или по умолчанию http://localhost:10000
paths:
  /ping:
    get:
      summary: Проверка доступности сервиса
      description: Быстрый health-check; при успешной работе возвращает строку «pong».
      operationId: ping
      responses:
        '200':
          description: Сервис отвечает и готов принимать запросы.
          content:
            text/plain:
              schema:
                type: string
              example: pong
  /api/memory/save:
    post:
      summary: Сохранение памяти пользователя
      description: >-
        Записывает текстовое содержимое в память пользователя по указанному пути.
        В опциональном объекте meta можно передавать дополнительные атрибуты (ключ-значение).
      operationId: saveMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId, path, content]
              properties:
                userId:
                  type: string
                  description: Уникальный идентификатор пользователя.
                path:
                  type: string
                  description: Логический путь или ключ записи.
                content:
                  type: string
                  description: Сохраняемый текст.
                meta:
                  type: object
                  additionalProperties: true
                  description: Произвольные метаданные (опционально).
            example:
              userId: user-123
              path: dialogs/2024-05-20
              content: "Новый ответ пользователя"
              meta:
                source: chat
      responses:
        '200':
          description: Запись сохранена.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  savedPath:
                    type: string
                    description: Итоговый путь сохранённой записи.
              example:
                status: ok
                savedPath: dialogs/2024-05-20
  /api/memory/read:
    post:
      summary: Чтение памяти пользователя
      description: Возвращает содержимое записи по userId и path.
      operationId: readMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId, path]
              properties:
                userId:
                  type: string
                  description: Уникальный идентификатор пользователя.
                path:
                  type: string
                  description: Путь ранее сохранённой записи.
            example:
              userId: user-123
              path: dialogs/2024-05-20
      responses:
        '200':
          description: Найденная запись.
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: string
                    description: Хранимый текст.
                  meta:
                    type: object
                    additionalProperties: true
                    description: Сохранённые метаданные (если есть).
              example:
                content: "Новый ответ пользователя"
                meta:
                  source: chat
        '404':
          description: Запись не найдена.
