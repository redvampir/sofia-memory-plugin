openapi: 3.1.0
info:
  title: Sofia Memory Plugin
  description: |
    Save and retrieve memory for the Sofia tutor using GitHub.
    Provides endpoints to save and load memory files such as lessons, training plans, and student context.
  version: "1.0.0"
servers:
  - url: https://sofia-memory.onrender.com

paths:
  /save:
    post:
      summary: Save memory content to GitHub
      operationId: saveMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SaveMemoryRequest"
      responses:
        '200':
          description: Memory saved successfully

  /read:
    post:
      summary: Read memory content from GitHub
      operationId: readMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ReadMemoryRequest"
      responses:
        '200':
          description: Memory read successfully

  /list:
    post:
      summary: List memory files in a directory
      operationId: listMemoryFiles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ListMemoryRequest"
      responses:
        "200":
          description: List of files returned successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  files:
                    type: array
                    items:
                      type: string

  /saveLessonPlan:
    post:
      summary: Update learning plan with completed lesson
      operationId: saveLessonPlan
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SaveLessonPlanRequest"
      responses:
        "200":
          description: Plan updated successfully

  /plan:
    get:
      summary: Read current plan information
      operationId: readPlan
      responses:
        "200":
          description: Current plan contents
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  plan:
                    type: object

components:
  schemas:
    SaveMemoryRequest:
      type: object
      properties:
        repo:
          type: string
          example: redvampir/sofia-memory-plugin
        token:
          type: string
        filename:
          type: string
          example: memory/test.md
        content:
          type: string
          example: Тестовый контент

    ReadMemoryRequest:
      type: object
      properties:
        repo:
          type: string
        token:
          type: string
        filename:
          type: string
          example: memory/test.md

    ListMemoryRequest:
      type: object
      properties:
        repo:
          type: string
        token:
          type: string
        path:
          type: string
      required:
        - repo
        - token
        - path

    SaveLessonPlanRequest:
      type: object
      properties:
        title:
          type: string
        summary:
          type: string
        projectFiles:
          type: array
          items:
            type: string
        plannedLessons:
          type: array
          items:
            type: string
