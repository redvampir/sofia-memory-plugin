openapi: 3.1.0
info:
  title: Sofia Memory Plugin
  version: "1.0.0"
servers:
  - url: https://sofia-memory.onrender.com
paths:
  /save:
    post:
      summary: Save file to repository
      operationId: save
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveMemoryRequest'
      responses:
        '200':
          description: Saved
  /saveMemory:
    post:
      summary: Save memory content
      operationId: saveMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveMemoryRequest'
      responses:
        '200':
          description: Saved
  /readMemory:
    post:
      summary: Read memory content
      operationId: readMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReadMemoryRequest'
      responses:
        '200':
          description: File contents
  /read:
    post:
      summary: Read memory content (alias)
      operationId: read
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReadMemoryRequest'
      responses:
        '200':
          description: File contents
  /readFile:
    post:
      summary: Read markdown file
      operationId: readFile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReadMemoryRequest'
      responses:
        '200':
          description: File contents
  /memory:
    get:
      summary: Read memory file via query
      operationId: readMemoryGET
      parameters:
        - in: query
          name: repo
          schema:
            type: string
        - in: query
          name: token
          schema:
            type: string
        - in: query
          name: filename
          schema:
            type: string
        - in: query
          name: userId
          schema:
            type: string
      responses:
        '200':
          description: File contents
  /setMemoryRepo:
    post:
      summary: Set repository for a user
      operationId: setMemoryRepo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                repoUrl:
                  type: string
                userId:
                  type: string
      responses:
        '200':
          description: Repo stored
  /saveLessonPlan:
    post:
      summary: Update learning plan
      operationId: saveLessonPlan
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveLessonPlanRequest'
      responses:
        '200':
          description: Plan updated
  /saveMemoryWithIndex:
    post:
      summary: Save memory and update index
      operationId: saveMemoryWithIndex
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveMemoryRequest'
      responses:
        '200':
          description: Saved
  /saveAnswer:
    post:
      summary: Save reference answer
      operationId: saveAnswer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveAnswerRequest'
      responses:
        '200':
          description: Saved
  /saveNote:
    post:
      summary: Save user note
      operationId: saveNote
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveNoteRequest'
      responses:
        '200':
          description: Note saved
  /getContextSnapshot:
    post:
      summary: Get context snapshot
      operationId: getContextSnapshot
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
      responses:
        '200':
          description: Snapshot data
  /createUserProfile:
    post:
      summary: Create user profile
      operationId: createUserProfile
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserProfileRequest'
      responses:
        '200':
          description: Profile created
  /getToken:
    post:
      summary: Get stored GitHub token
      operationId: getToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
      responses:
        '200':
          description: Token value
  /plan:
    get:
      summary: Read current plan
      operationId: readPlan
      responses:
        '200':
          description: Plan data
  /profile:
    get:
      summary: Read stored profile
      operationId: readProfile
      parameters:
        - in: query
          name: userId
          schema:
            type: string
      responses:
        '200':
          description: Profile data
  /setToken:
    post:
      summary: Store GitHub token
      operationId: setToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SetTokenRequest'
      responses:
        '200':
          description: Token stored status
  /token/status:
    get:
      summary: Check if a token is stored
      operationId: tokenStatus
      parameters:
        - in: query
          name: userId
          schema:
            type: string
      responses:
        '200':
          description: Status info
  /tokenStatus:
    get:
      summary: Check if a token is stored (alias)
      operationId: tokenStatusAlias
      parameters:
        - in: query
          name: userId
          schema:
            type: string
      responses:
        '200':
          description: Status info
  /saveContext:
    post:
      summary: Save context content
      operationId: saveContext
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveContextRequest'
      responses:
        '200':
          description: Context saved
  /readContext:
    get:
      summary: Read stored context
      operationId: readContext
      responses:
        '200':
          description: Context data
  /loadMemoryToContext:
    post:
      summary: Load a memory file into context
      operationId: loadMemoryToContext
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoadMemoryToContextRequest'
      responses:
        '200':
          description: Load result
  /loadContextFromIndex:
    post:
      summary: Load context using index entry
      operationId: loadContextFromIndex
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoadContextFromIndexRequest'
      responses:
        '200':
          description: Load result
  /chat/setup:
    post:
      summary: Parse setup message
      operationId: chatSetup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
      responses:
        '200':
          description: Setup parsed
  /updateIndex:
    post:
      summary: Manually update index entries
      operationId: updateIndex
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateIndexRequest'
      responses:
        '200':
          description: Updated entries
  /list:
    post:
      summary: List memory files
      operationId: listFiles
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ListFilesRequest'
      responses:
        '200':
          description: File list
  /version/commit:
    post:
      summary: Commit instructions version
      operationId: commitInstructions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommitInstructionsRequest'
      responses:
        '200':
          description: Version saved
  /version/rollback:
    post:
      summary: Roll back instructions
      operationId: rollbackInstructions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RollbackInstructionsRequest'
      responses:
        '200':
          description: Restored version
  /version/list:
    post:
      summary: List instruction versions
      operationId: listVersions
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VersionListRequest'
      responses:
        '200':
          description: Version history
  /ping:
    get:
      summary: Health check
      operationId: ping
      responses:
        '200':
          description: Pong
components:
  schemas:
    SaveMemoryRequest:
      type: object
      properties:
        repo:
          type: string
        token:
          type: string
        filename:
          type: string
        content:
          type: string
    ReadMemoryRequest:
      type: object
      properties:
        repo:
          type: string
        token:
          type: string
        filename:
          type: string
    SaveLessonPlanRequest:
      type: object
      properties:
        title:
          type: string
        summary:
          type: string
        projectFiles:
          type: array
          items:
            type: string
        plannedLessons:
          type: array
          items:
            type: string
    SaveAnswerRequest:
      type: object
      properties:
        key:
          type: string
        content:
          type: string
        repo:
          type: string
        token:
          type: string
        userId:
          type: string
    SaveNoteRequest:
      type: object
      properties:
        userId:
          type: string
        note:
          type: string
    CreateUserProfileRequest:
      type: object
      properties:
        userId:
          type: string
        profile:
          type: string
    SetTokenRequest:
      type: object
      properties:
        userId:
          type: string
        token:
          type: string
    SaveContextRequest:
      type: object
      properties:
        repo:
          type: string
        token:
          type: string
        userId:
          type: string
        content:
          type: string
    LoadMemoryToContextRequest:
      type: object
      properties:
        filename:
          type: string
        repo:
          type: string
        token:
          type: string
        userId:
          type: string
    LoadContextFromIndexRequest:
      type: object
      properties:
        index:
          type: string
        repo:
          type: string
        token:
          type: string
        userId:
          type: string
    IndexEntry:
      type: object
      properties:
        path:
          type: string
        title:
          type: string
        type:
          type: string
        description:
          type: string
        lastModified:
          type: string
    UpdateIndexRequest:
      type: object
      properties:
        entries:
          type: array
          items:
            $ref: '#/components/schemas/IndexEntry'
        repo:
          type: string
        token:
          type: string
        userId:
          type: string
    ListFilesRequest:
      type: object
      properties:
        repo:
          type: string
        token:
          type: string
        path:
          type: string
    CommitInstructionsRequest:
      type: object
      properties:
        version:
          type: string
        content:
          type: string
    RollbackInstructionsRequest:
      type: object
      properties:
        version:
          type: string
        historyFile:
          type: string
    VersionListRequest:
      type: object
      properties:
        version:
          type: string
