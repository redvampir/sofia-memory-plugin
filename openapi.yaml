openapi: 3.1.0
info:
  title: Sofia Memory API
  version: 1.0.0
  description: >-
    Минимальное описание публичных методов памяти Софии для интеграции
    внешних сервисов.
  license:
    name: MIT
    url: https://opensource.org/license/mit
servers:
  - url: https://sofia-memory.onrender.com
    description: Render server
security: []
paths:
  /ping:
    get:
      summary: Проверка доступности сервиса
      description: Быстрый health-check; при успешной работе возвращает JSON с полем состояния.
      operationId: ping
      responses:
        '200':
          description: Сервис отвечает и готов принимать запросы.
          content:
            application/json:
              schema:
                type: object
                required: [ok, message]
                properties:
                  ok:
                    type: boolean
                    description: Признак доступности сервиса.
                  message:
                    type: string
                    description: Сообщение-подтверждение.
              example:
                ok: true
                message: pong
        '400':
          description: Неверный запрос (например, некорректный HTTP-метод).
        '503':
          description: Сервис временно недоступен.
  /api/memory/save:
    post:
      summary: Сохранение памяти пользователя
      description: >-
        Записывает содержимое в файловое хранилище памяти. Если указан GitHub-репозиторий,
        требуется валидный токен (может передаваться в заголовке `Authorization: Bearer <token>`
        или полем `token`).
      operationId: saveMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id, type, version, data]
              properties:
                id:
                  type: string
                  description: Уникальный идентификатор записи памяти.
                type:
                  type: string
                  description: Тип записи (например, message, note).
                version:
                  type: integer
                  description: Версия сохраняемого объекта.
                data:
                  type: object
                  description: Произвольное содержимое записи.
                repo:
                  type: string
                  description: Полный URL GitHub-репозитория для сохранения.
                userId:
                  type: string
                  description: Идентификатор пользователя, для которого сохраняется память.
                token:
                  type: string
                  description: GitHub-токен (если не передаётся через заголовок Authorization).
            example:
              id: "memory/profile/user.json"
              type: message
              version: 1
              data:
                name: Sofia
                role: assistant
              repo: "https://github.com/org/memory-repo"
              userId: "sofia"
      responses:
        '200':
          description: Результат сохранения.
          content:
            application/json:
              schema:
                type: object
                required: [ok, data]
                properties:
                  ok:
                    type: boolean
                    description: Признак успешного выполнения операции.
                  data:
                    type: object
                    nullable: true
                    description: Сохранённые данные или null при ошибке.
                  error:
                    type: string
                    description: Описание ошибки, если операция завершилась неуспешно.
              example:
                ok: true
                data:
                  id: "memory/profile/user.json"
                  type: message
                  version: 1
                  data:
                    name: Sofia
                    role: assistant
                error: null
  /api/memory/read:
    post:
      summary: Чтение памяти пользователя
      description: Возвращает содержимое файла памяти. Для JSON-файлов параллельно отдаётся распарсенный объект. Если локальный файл отсутствует, возвращает успешный ответ с `data: null`.
      operationId: readMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [id, type, version, data]
              properties:
                id:
                  type: string
                  description: Уникальный идентификатор записи памяти.
                type:
                  type: string
                  description: Тип записи (например, message, note).
                version:
                  type: integer
                  description: Версия запрашиваемого объекта.
                data:
                  type: object
                  description: Дополнительные параметры запроса чтения.
                repo:
                  type: string
                  description: Полный URL GitHub-репозитория для чтения.
                userId:
                  type: string
                  description: Идентификатор пользователя, для которого читается память.
                token:
                  type: string
                  description: GitHub-токен (если не передаётся через заголовок Authorization).
            example:
              id: "memory/profile/user.json"
              type: message
              version: 1
              data:
                includeMeta: true
              userId: "sofia"
      responses:
        '200':
          description: Результат чтения.
          content:
            application/json:
              schema:
                type: object
                required: [ok, data]
                properties:
                  ok:
                    type: boolean
                    description: Признак успешного выполнения операции.
                  data:
                    type: object
                    nullable: true
                    description: Прочитанные данные или null, если запись не найдена.
                  error:
                    type: string
                    description: Описание ошибки, если операция завершилась неуспешно.
              examples:
                found:
                  summary: Найденная запись
                  value:
                    ok: true
                    data:
                      id: "memory/profile/user.json"
                      type: message
                      version: 1
                      data:
                        name: Sofia
                        role: assistant
                missing:
                  summary: Запись отсутствует
                  value:
                    ok: true
                    data: null
                    error: null
