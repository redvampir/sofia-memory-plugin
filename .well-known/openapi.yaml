openapi: 3.1.0
info:
  title: Минимальное API памяти Софии
  version: 1.0.0
  description: |
    Компактная схема для публичных методов памяти. Описывает только базовые
    операции проверки доступности и записи/чтения заметок.
servers:
  - url: https://sofia-memory.onrender.com
    description: Публичный Render-инстанс
  - url: http://localhost:10000
    description: Локальный запуск для разработки
paths:
  /ping:
    get:
      summary: Проверка доступности сервиса
      description: Возвращает подтверждение, что сервер отвечает.
      operationId: ping
      responses:
        '200':
          description: Сервис доступен.
          content:
            application/json:
              schema:
                type: object
                required: [ok, message]
                properties:
                  ok:
                    type: boolean
                    description: Признак доступности сервиса.
                  message:
                    type: string
                    description: Ответ сервера.
              examples:
                success:
                  value:
                    ok: true
                    message: pong
  /api/memory/save:
    post:
      summary: Сохранение заметки в памяти
      description: Принимает текст заметки и привязывает его к пользователю.
      operationId: saveMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [text]
              properties:
                userId:
                  type: string
                  description: Идентификатор пользователя (по умолчанию "default" если не передан).
                text:
                  type: string
                  description: Текст заметки для сохранения.
            examples:
              default:
                value:
                  userId: default
                  text: "Запомни, что доклад в пятницу в 15:00"
      responses:
        '200':
          description: Заметка сохранена.
          content:
            application/json:
              schema:
                type: object
                required: [status, message]
                properties:
                  status:
                    type: string
                    description: Статус обработки запроса.
                  message:
                    type: string
                    description: Текстовое подтверждение сохранения.
              examples:
                success:
                  value:
                    status: ok
                    message: "Заметка добавлена"
        '400':
          description: Некорректные данные запроса.
  /api/memory/read:
    post:
      summary: Чтение заметок из памяти
      description: Возвращает сохранённые записи для пользователя, отфильтрованные по запросу.
      operationId: readMemory
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                  description: Идентификатор пользователя (по умолчанию "default" если не передан).
                query:
                  type: string
                  description: Произвольный текст запроса для поиска релевантных заметок.
            examples:
              simple:
                value:
                  userId: default
                  query: "Когда доклад?"
      responses:
        '200':
          description: Подходящие записи найдены и возвращены.
          content:
            application/json:
              schema:
                type: object
                required: [status, items]
                properties:
                  status:
                    type: string
                    description: Статус обработки запроса.
                  items:
                    type: array
                    description: Список найденных заметок.
                    items:
                      type: object
                      required: [text]
                      properties:
                        text:
                          type: string
                          description: Текст сохранённой заметки.
                        score:
                          type: number
                          format: float
                          description: Релевантность записи запросу (если доступна).
              examples:
                result:
                  value:
                    status: ok
                    items:
                      - text: "Доклад в пятницу в 15:00"
                        score: 0.92
        '404':
          description: Соответствующие записи не найдены.
components: {}
